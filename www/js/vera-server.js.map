{
  "version": 3,
  "file": "vera-server.js",
  "sourceRoot": "../../",
  "sources": [
    "www/js/vera-server.coffee"
  ],
  "names": [],
  "mappings": "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",
  "sourcesContent": [
    "class App.VeraServer\r\n\tconstructor: (@manager, @serverDef, @veraReadyCallback) ->\r\n\t\t@ACTIONS_URI = @serverDef.url + \"/data_request?id=user_data2&output_format=xml\"\r\n\r\n\tsetReadyCallback: (@veraReadyCallback) ->\r\n\r\n\treqActions: ->\r\n\t\t$.ajax @ACTIONS_URI,\r\n\t\t\ttype: \"GET\"\r\n\t\t\tdataType: \"xml\"\r\n\t\t\tcrossDomain: true\r\n\t\t\tsuccess: (data, textStatus, jqXHR) =>\r\n\t\t\t\t@rooms = @getRooms(jqXHR.responseText)\r\n\t\t\t\t@scenes = @getScenes(jqXHR.responseText, @rooms)\r\n\t\t\t\t@scenes.sort @sortByRoomName\r\n\t\t\t\t@veraReadyCallback(@serverDef.name, @scenes)\r\n\r\n\tsortByRoomName: (a, b) ->\r\n\t\tif a.groupName < b.groupName then return -1\r\n\t\tif a.groupName > b.groupName then return 1\r\n\t\treturn 0\r\n\r\n\tgetMatches: (inText, re) ->\r\n\t\tmatches = []\r\n\t\ttext = inText\r\n\t\twhile true\r\n\t\t\tgrpInfo = re.exec(text)\r\n\t\t\tif grpInfo is null then break\r\n\t\t\tpos = text.search re\r\n\t\t\tif pos is -1 then break\r\n\t\t\ttext = text.substring(pos+grpInfo[0].length)\t\t\t\r\n\t\t\tmatches[matches.length] = grpInfo[1]\r\n\t\tmatches\r\n\r\n\tgetScenes: (respText, rooms) ->\r\n\t\tscenes = []\r\n\t\tmatchScene = ///\r\n\t\t\t<scene\\b(.*?)>\r\n\t\t\t///\r\n\t\tstrMatches = @getMatches(respText, matchScene)\r\n\t\tfor mtch in strMatches\r\n\t\t\t@addScene(scenes, mtch, rooms)\r\n\t\tscenes\r\n\r\n\taddScene: (scenes, tagBody, rooms) ->\r\n\t\tre1 = /name=\"(.*?)\"/\r\n\t\tgrp1 = re1.exec(tagBody)\r\n\t\tif grp1 is null then return\r\n\t\tre2 = /id=\"(.*?)\"/\r\n\t\tgrp2 = re2.exec(tagBody)\r\n\t\tif grp2 is null then return\r\n\t\tre3 = /room=\"(.*?)\"/\r\n\t\tgrp3 = re3.exec(tagBody)\r\n\t\tif grp3 is null then return\r\n\t\troom = \"\"\r\n\t\tif grp3[1] of rooms\r\n\t\t\troom = rooms[grp3[1]]\r\n\t\tsceneCmd = @serverDef.url + \"/data_request?id=lu_action&serviceId=urn:micasaverde-com:serviceId:HomeAutomationGateway1&action=RunScene&SceneNum=\" + grp2[1]\r\n\t\tscenes[scenes.length] = { actionNum: grp2[1], actionName: grp1[1], groupName: room, actionUrl: sceneCmd }\r\n\t\t# console.log(grp2[1] + \" \" + grp1[1] + \" \" + room + \" \" + sceneCmd)\r\n\r\n\tgetRooms: (respText) ->\r\n\t\trooms = {}\r\n\t\tmatchRoom = ///\r\n\t\t\t<room\\b(.*?)>\r\n\t\t\t///\r\n\t\tstrMatches = @getMatches(respText, matchRoom)\r\n\t\tfor mtch in strMatches\r\n\t\t\t@addRoom(rooms, mtch)\r\n\t\trooms\r\n\r\n\taddRoom: (rooms, tagBody) ->\r\n\t\tre1 = /name=\"(.*?)\"/\r\n\t\tgrp1 = re1.exec(tagBody)\r\n\t\tif grp1 is null then return\r\n\t\tre2 = /id=\"(.*?)\"/\r\n\t\tgrp2 = re2.exec(tagBody)\r\n\t\tif grp2 is null then return\r\n\t\trooms[grp2[1]] = grp1[1]\r\n"
  ]
}