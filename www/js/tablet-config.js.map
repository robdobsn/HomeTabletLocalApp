{
  "version": 3,
  "file": "tablet-config.js",
  "sourceRoot": "../../",
  "sources": [
    "www/js/tablet-config.coffee"
  ],
  "names": [],
  "mappings": "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",
  "sourcesContent": [
    "class App.TabletConfigManager\r\n\tconstructor: (@defaultTabletName, @defaultTabletConfigUrl) ->\r\n\t\t@configData = {}\r\n\t\t@defaultTabletConfig = new App.DefaultTabletConfig()\r\n\t\t@defaultConfigSettings =\r\n\t\t\tshowCalServerSetting: true\r\n\t\t\tshowAutomationServerSettings: [\"Indigo\",\"Vera\",\"Fibaro\"]\r\n\t\t\tshowEnergyServerSetting: true\r\n\t\tconsole.log(\"tablet-config constructed with defaults defaultTabletName \" + @defaultTabletName)\r\n\t\treturn\r\n\r\n\tgetTabName: ->\r\n\t\t# See if the tablet's name is in the local storage\r\n\t\ttabNameStored = App.LocalStorage.get(\"DeviceConfigName\")\r\n\t\ttabName = @defaultTabletName\r\n\t\tif tabNameStored? and tabNameStored isnt \"\"\r\n\t\t\ttabName = tabNameStored\r\n\t\t\tconsole.log(\"tablet-config getTabName from local storage = \" + tabName)\r\n\t\telse\r\n\t\t\tconsole.log(\"tablet-config getTabName using default \" + tabName)\r\n\t\treturn tabName\r\n\r\n\tgetReqUrl: ->\r\n\t\treqURL = @defaultTabletConfigUrl\r\n\t\tif not reqURL? or reqURL is \"\"\r\n\t\t\treturn \"\"\r\n\t\ttabName = @getTabName()\r\n\t\treqURL = reqURL.trim()\r\n\t\treqURL = reqURL + (if reqURL.slice(-1) is \"/\" then \"\" else \"/\") + \"tabletconfig/\" + tabName\r\n\t\tconsole.log(\"tablet-config getReqUrl \" + reqURL)\r\n\t\treturn reqURL\r\n\r\n\tsetReadyCallback: (@readyCallback) ->\r\n\r\n\tgetConfigData: ->\r\n\t\treturn @configData\r\n\t\t\r\n\taddFavouriteButton: (buttonInfo) ->\r\n\t\tconsole.log \"Add \" + buttonInfo.tileName\r\n\t\tif \"favourites\" not of @configData\r\n\t\t\t@configData.favourites = []\r\n\t\t@configData.favourites.push\r\n\t\t\ttileName: buttonInfo.tileName\r\n\t\t\tgroupName: buttonInfo.groupName\r\n\t\t@saveDeviceConfig()\r\n\r\n\tdeleteFavouriteButton: (buttonInfo) ->\r\n\t\tconsole.log \"Delete \" + buttonInfo.tileName\r\n\t\tif \"favourites\" not of @configData\r\n\t\t\treturn\r\n\t\tfavIdx = -1\r\n\t\tfor fav, idx in @configData.favourites\r\n\t\t\tif fav.tileName is buttonInfo.tileName and fav.groupName is buttonInfo.groupName\r\n\t\t\t\tfavIdx = idx\r\n\t\t\t\tbreak\r\n\t\tif favIdx >= 0\r\n\t\t\t@configData.favourites.splice(favIdx, 1)\r\n\t\t\t@saveDeviceConfig()\r\n\r\n\tsaveDeviceConfig: ->\r\n\t\treqURL = @getReqUrl()\r\n\t\tApp.LocalStorage.set(reqURL, @configData)\r\n\t\ttabName = @getTabName()\r\n\t\tif not tabName? or tabName is \"\"\r\n\t\t\tconsole.log \"tablet-config Unable to save device config as tablet name unknown\"\r\n\t\telse\r\n\t\t\tconsole.log \"tablet-config Saving device config for \" + tabName\r\n\t\t# Store back to the server \r\n\t\t$.ajax \r\n\t\t\turl: reqURL\r\n\t\t\ttype: 'POST'\r\n\t\t\tdata: JSON.stringify({\"favourites\":@configData.favourites})\r\n\t\t\tcontentType: \"application/json\"\r\n\t\t\tsuccess: (data, status, response) =>\r\n\t\t\t\tconsole.log \"tablet-config Sent new config data ok\"\r\n\t\t\terror: (jqXHR, textStatus, errorThrown) =>\r\n\t\t\t\tconsole.error (\"tablet-config Failed to send new config data: \" + textStatus + \" \" + errorThrown)\r\n\r\n\tapplyStoredData: (reqURL) ->\r\n\t\tstoredData = App.LocalStorage.get(reqURL)\r\n\t\tconsole.log \"tablet-config Config Getting data stored for \" + reqURL + \" result = \" + storedData\r\n\t\tif storedData?\r\n\t\t\t# console.log \"Using stored data\" + JSON.stringify(storedData)\r\n\t\t\tconsole.log \"tablet-config Using stored data for \" + reqURL\r\n\t\t\t@configData = storedData\r\n\t\telse\r\n\t\t\t@configData = @defaultTabletConfig.get(@defaultConfigSettings)\r\n\t\t@readyCallback()\r\n\r\n\trequestConfig: ->\r\n\t\treqURL = @getReqUrl()\r\n\r\n\t\t# Handle no config server situation\r\n\t\tif reqURL is \"\"\r\n\t\t\t@configData = @defaultTabletConfig.get(@defaultConfigSettings)\r\n\t\t\t@readyCallback()\r\n\t\t\treturn\r\n\r\n\t\t# Get the configuration from the server\r\n\t\ttabName = @getTabName()\r\n\t\tconsole.log(\"tablet-config Requesting tablet config from tabname \" + @getTabName() + \" using URL \" + reqURL)\r\n\r\n\t\t# get the tablet config from a server\r\n\t\t@catchAjaxFail = setTimeout(@ajaxFailTimeout, 2000)\r\n\t\t$.ajax reqURL,\r\n\t\t\ttype: \"GET\"\r\n\t\t\tdataType: \"text\"\r\n\t\t\tcrossDomain: true\r\n\t\t\ttimeout: 1500\r\n\t\t\tsuccess: (data, textStatus, jqXHR) =>\r\n\t\t\t\tclearTimeout(@catchAjaxFail)\r\n\t\t\t\tjsonText = jqXHR.responseText\r\n\t\t\t\tjsonData = $.parseJSON(jsonText)\r\n\t\t\t\tif jsonText is \"{}\"\r\n\t\t\t\t\tconsole.log(\"tablet-config Got tablet config but it's empty\")\r\n\t\t\t\t\t@configData = @defaultTabletConfig.get(@defaultConfigSettings)\r\n\t\t\t\t\t@applyStoredData(reqURL)\r\n\t\t\t\telse\r\n\t\t\t\t\t# console.log \"tablet-config Got tablet config data\"\r\n\t\t\t\t\tcurTabName = @getTabName()\r\n\t\t\t\t\ttabName = if \"deviceName\" of jsonData then jsonData.deviceName else curTabName\r\n\t\t\t\t\tif tabName? and tabName isnt curTabName\r\n\t\t\t\t\t\tApp.LocalStorage.set(\"DeviceConfigName\", tabName)\r\n\t\t\t\t\t\tconsole.log(\"tablet-config DeviceConfigName was \" + curTabName + \" now set to \" + tabName)\r\n\t\t\t\t\t\tApp.LocalStorage.logEvent(\"CnfLog\", \"DeviceConfigName was \" + curTabName + \" now set to \" + tabName)\r\n\t\t\t\t\t@configData = jsonData\r\n\t\t\t\t\tApp.LocalStorage.set(reqURL, @configData)\r\n\t\t\t\t\tif (\"common\" of jsonData) and (\"servers\" of jsonData.common)\r\n\t\t\t\t\t\tconsole.log \"tablet-config got \" + tabName + \" len \" + JSON.stringify(jsonData).length + \" #servers \" + jsonData.common.servers.length\r\n\t\t\t\t\telse\r\n\t\t\t\t\t\tconsole.log \"tablet-config got \" + tabName + \" len \" + JSON.stringify(jsonData).length + \" NO SERVERS DEFINED\"\r\n\t\t\t\t\tif (\"deviceName\" of jsonData)\r\n\t\t\t\t\t\tconsole.log \"tablet-config got \" + tabName + \" deviceName \" + jsonData.deviceName\r\n\t\t\t\t\telse\r\n\t\t\t\t\t\tconsole.log \"tablet-config got \" + tabName + \" deviceName NOT PRESENT\"\r\n\t\t\t\t\t\tconsole.log \"\"\r\n\t\t\t\t\t\tconsole.log jsonText\r\n\t\t\t\t\t\tconsole.log \"\"\r\n\t\t\t\t\tif (\"roomName\" of jsonData)\r\n\t\t\t\t\t\tconsole.log \"tablet-config got \" + tabName + \" roomName \" + jsonData.roomName\r\n\t\t\t\t\telse\r\n\t\t\t\t\t\tconsole.log \"tablet-config got \" + tabName + \" roomName NOT PRESENT\"\r\n\t\t\t\t\tif (\"sonosRoomName\" of jsonData)\r\n\t\t\t\t\t\tconsole.log \"tablet-config got \" + tabName + \" sonosRoomName \" + jsonData.sonosRoomName\r\n\t\t\t\t\telse\r\n\t\t\t\t\t\tconsole.log \"tablet-config got \" + tabName + \" sonosRoomName NOT PRESENT\"\r\n\t\t\t\t\t@readyCallback()\r\n\t\t\t\treturn\r\n\t\t\terror: (jqXHR, textStatus, errorThrown) =>\r\n\t\t\t\tconsole.log \"tablet-config Get tablet config data failed with an error \" + textStatus\r\n\t\t\t\t# Use stored data if available\r\n\t\t\t\tclearTimeout(@catchAjaxFail)\r\n\t\t\t\t@applyStoredData(reqURL)\r\n\t\t\t\treturn\r\n\t\treturn\r\n\r\n\tajaxFailTimeout: ->\r\n\t\tconsole.log(\"tablet-config Get tablet config timed out via setTimeout\")\r\n\t\t@configData = @defaultTabletConfig.get(@defaultConfigSettings)\r\n\t\t@readyCallback()\r\n\t\treturn\r\n"
  ]
}