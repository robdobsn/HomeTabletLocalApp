{
  "version": 3,
  "file": "calendar-tile.js",
  "sourceRoot": "..\\..",
  "sources": [
    "www\\js\\calendar-tile.coffee"
  ],
  "names": [],
  "mappings": "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",
  "sourcesContent": [
    "class App.CalendarTile extends App.Tile\r\n\tconstructor: (@app, tileDef, @calDayIndex) ->\r\n\t\tsuper tileDef\r\n\t\t@shortDayNames = [\"Sun\", \"Mon\", \"Tue\", \"Wed\", \"Thu\", \"Fri\", \"Sat\"]\r\n\t\t@calLineCount = 0; @calCharCount = 0; @calMaxLineLen = 0\r\n\t\t@secsBetweenCalendarRefreshes = 60\r\n\t\treturn\r\n\r\n\thandleAction: (action) ->\r\n\t\tif action is \"next\"\r\n\t\t\tif @calDayIndex < @app.calendarManager.getCalNumDays()\r\n\t\t\t\t@calDayIndex++\r\n\t\telse if action is \"prev\"\r\n\t\t\tif @calDayIndex > 0\r\n\t\t\t\t@calDayIndex--\r\n\t\t@updateCalendar()\r\n\t\treturn\r\n\r\n\taddToDoc: () ->\r\n\t\tsuper()\r\n\t\t@setRefreshInterval(@secsBetweenCalendarRefreshes, @updateCalendar, true)\r\n\t\treturn\r\n\r\n\tupdateCalendar: () ->\r\n\t\tcalData = @app.calendarManager.getCalData()\r\n\t\t@showCalendar(calData)\r\n\r\n\tshowCalendar: (jsonData) ->\r\n\t\tif not (\"calEvents\" of jsonData)\r\n\t\t\treturn\r\n\t\tnewHtml = \"\"\r\n\r\n\t\t# Calendar boxes can be for each of the next few days so see which date this one is for\r\n\t\treqDate = new Date()\r\n\t\treqDate.setDate(reqDate.getDate()+@calDayIndex);\r\n\t\treqDateStr = @toZeroPadStr(reqDate.getFullYear(), 4) + \r\n\t\t\t\t@toZeroPadStr(reqDate.getMonth()+1, 2) +\r\n\t\t\t\t@toZeroPadStr(reqDate.getDate(), 2)\r\n\t\tcalTitle = \"\"\r\n\t\tif @calDayIndex is 0\r\n\t\t\tcalTitle = \"Today \"\r\n\t\tcalTitle += @shortDayNames[reqDate.getDay()]\r\n\t\tcalTitle += \" \" + @toZeroPadStr(reqDate.getDate(), 2) + \"/\" +\r\n\t\t\t@toZeroPadStr(reqDate.getMonth()+1, 2) + \"/\" +\r\n\t\t\t@toZeroPadStr(reqDate.getFullYear(), 4)\r\n\r\n\t\t# Format the text to go into the calendar and keep stats on it for font sizing\r\n\t\t@calLineCount = 0; @calCharCount = 0; @calMaxLineLen = 0\r\n\t\tfor event in jsonData[\"calEvents\"]\r\n\t\t\tif event[\"eventDate\"] is reqDateStr\r\n\t\t\t\t@calLineCount += 1\r\n\t\t\t\tnewLine = \"\"\"\r\n\t\t\t\t\t<span class=\"sqCalEventStart\">#{event[\"eventTime\"]}</span>\r\n\t\t\t\t\t<span class=\"sqCalEventDur\"> (#{@formatDurationStr(event[\"duration\"])}) </span>\r\n\t\t\t\t\t<span class=\"sqCalEventSummary\">#{event[\"summary\"]}</span>\r\n\t\t\t\t\t\"\"\"\r\n\t\t\t\tnewHtml += \"\"\"\r\n\t\t\t\t\t<li class=\"sqCalEvent\">\r\n\t\t\t\t\t\t#{newLine}\r\n\t\t\t\t\t</li>\r\n\t\t\t\t\t\"\"\"\r\n\t\t\t\t@calCharCount += newLine.length\r\n\t\t\t\t@calMaxLineLen = if @calMaxLineLen < newLine.length then newLine.length else @calMaxLineLen\r\n\r\n\t\t# Check for non-busy day\r\n\t\tif newHtml is \"\"\r\n\t\t\tnewHtml = \"Nothing doing\"\r\n\t\t# Place the calendar text\r\n\t\t@contents.html \"\"\"\r\n\t\t\t<div class=\"sqCalTitle\" style=\"font-size:26px;font-weight:bold;color:white;\">#{calTitle}</div>\r\n\t\t\t<ul class=\"sqCalEvents\">\r\n\t\t\t\t#{newHtml}\r\n\t\t\t</ul>\r\n\t\t\t\"\"\"\r\n\t\t# Calculate optimal font size\r\n\t\t@recalculateFontScaling()\r\n\t\treturn\r\n\r\n\t# Utility function for leading zeroes\r\n\ttoZeroPadStr: (value, digits) ->\r\n\t\ts = \"0000\" + value\r\n\t\treturn s.substr(s.length-digits)\r\n\r\n\t# Override reposition to handle font scaling\r\n\treposition: (posX, posY, sizeX, sizeY) ->\r\n\t\tsuper(posX, posY, sizeX, sizeY)\r\n\t\t@recalculateFontScaling()\r\n\t\treturn\r\n\r\n\t# Calculate width of text from DOM element or string. By Phil Freo <http://philfreo.com>\r\n\t# This works but doesn't do what I want - which is to calculate the actual width of text\r\n\t# including overflowed text in a box of fixed width - what it does is removes the box width\r\n\t# restriction and calculates the overall width of the text at the given font size - useful\r\n\t# in some situations but not what I need\r\n\tcalcTextWidth: (text, fontSize, boxWidth) ->\r\n\t\t@fakeEl = $(\"<span>\").hide().appendTo(document.body) unless @fakeEl?\r\n\t\t@fakeEl.text(text).css(\"font-size\", fontSize)\r\n\t\treturn @fakeEl.width()\r\n\r\n\tfindOptimumFontSize: (optHeight, docElem, initScale, maxFontScale) ->\r\n\t\tavailSize = (if optHeight then @sizeY else @sizeX) * 0.9\r\n\t\tcalText = @getElement(docElem)\r\n\t\t# console.log @calcTextWidth(calText.text(), calText.css(\"font-size\"))\r\n\t\ttextSize = if optHeight then calText.height() else @calcTextWidth(calText.text(), calText.css(\"font-size\"))\r\n\t\tif not textSize? then return 1.0\r\n\t\tfontScale = if optHeight then availSize / textSize else initScale\r\n\t\tfontScale = if fontScale > maxFontScale then maxFontScale else fontScale\r\n\t\t@setContentFontScaling(fontScale)\r\n\t\tsizeInc = 1.0\r\n\t\t# Iterate through possible sizes in a kind of binary tree search\r\n\t\tfor i in [0..6]\r\n\t\t\tcalText = @getElement(docElem)\r\n\t\t\ttextSize = if optHeight then calText.height() else @calcTextWidth(calText.text(), calText.css(\"font-size\"))\r\n\t\t\tif not textSize? then return fontScale\r\n\t\t\tif textSize > availSize\r\n\t\t\t\tfontScale = fontScale * (1 - (sizeInc/2))\r\n\t\t\t\t@setContentFontScaling(fontScale)\r\n\t\t\telse if textSize < (availSize * 0.75) and fontScale < maxFontScale\r\n\t\t\t\tfontScale = fontScale * (1 + sizeInc)\r\n\t\t\t\t@setContentFontScaling(fontScale)\r\n\t\t\telse\r\n\t\t\t\tbreak\r\n\t\t\tsizeInc *= 0.5\r\n\t\treturn fontScale\r\n\r\n\t# Provide a different font scaling based on the amount of text in the calendar box\r\n\trecalculateFontScaling: () ->\r\n\t\tif not @sizeX? or not @sizeY? or (@calLineCount is 0) then return\r\n\t\tfontScale = @findOptimumFontSize(true, \".sqCalEvents\", 1.0, 2.2)\r\n\t\t#fontScale = @findOptimumFontSize(false, \".sqCalEvents\", yScale)\r\n\t\t@setContentFontScaling(fontScale)\r\n\t\treturn\r\n\t\r\n\tsetContentFontScaling: (contentFontScaling) ->\r\n\t\tcss =\r\n\t\t\t\"font-size\": (100 * contentFontScaling) + \"%\"\r\n\t\t$(\".sqCalEvents\").css(css)\r\n\t\treturn\r\n\r\n\tformatDurationStr: (val) ->\r\n\t\tdur = val.split(\":\")\r\n\t\tdays = parseInt(dur[0])\r\n\t\thrs = parseInt(dur[1])\r\n\t\tmins = parseInt(dur[2])\r\n\t\toutStr = \"\"\r\n\t\tif days is 0 and hrs isnt 0 and mins is 30\r\n\t\t\toutStr = (hrs+0.5) + \"h\"\r\n\t\telse\r\n\t\t\toutStr = if days is 0 then \"\" else (days + \"d\")\r\n\t\t\toutStr += if hrs is 0 then \"\" else (hrs + \"h\")\r\n\t\t\toutStr += if mins is 0 then \"\" else (mins + \"m\")\r\n\t\treturn outStr\r\n\r\n"
  ]
}