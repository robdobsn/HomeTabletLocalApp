{
  "version": 3,
  "file": "domoticz-server.js",
  "sourceRoot": "../../",
  "sources": [
    "www/js/domoticz-server.coffee"
  ],
  "names": [],
  "mappings": "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",
  "sourcesContent": [
    "class App.DomoticzServer\r\n\tconstructor: (@manager, @serverDef, @dataReadyCallback) ->\r\n\t\t@ACTIONS_URI = @serverDef.url + \"/json.htm?type=scenes\"\r\n\t\t@numRefreshFailuresSinceSuccess = 0\r\n\t\t@firstRefreshAfterFailSecs = 10\r\n\t\t@nextRefreshesAfterFailSecs = 60\r\n\t\treturn\r\n\r\n\tsetReadyCallback: (@dataReadyCallback) ->\r\n\t\treturn\r\n\r\n\treqActions: ->\r\n\t\tconsole.log \"domiticz-server Requesting Domoticz data from \" + @ACTIONS_URI\r\n\t\t$.ajax @ACTIONS_URI,\r\n\t\t\ttype: \"GET\"\r\n\t\t\tdataType: \"json\"\r\n\t\t\tcrossDomain: true\r\n\t\t\tsuccess: (data, textStatus, jqXHR) =>\r\n\t\t\t\t@processRecvdActions(data)\r\n\t\t\t\t# console.log \"Domoticz data = \" + JSON.stringify(@scenes)\r\n\t\t\t\tconsole.log \"domiticz-server Received Domoticz data from \" + @ACTIONS_URI\r\n\t\t\t\t@numRefreshFailuresSinceSuccess = 0\r\n\t\t\t\tApp.LocalStorage.set(@ACTIONS_URI, data)\r\n\t\t\t\treturn\r\n\t\t\terror: (jqXHR, textStatus, errorThrown) =>\r\n\r\n\t\t\t\tconsole.log(\"domiticz-server \" + \" DOMOTICZ AjaxFail Status= \" + textStatus + \" URL= \" + @ACTIONS_URI + \" Error= \" + errorThrown);\r\n\r\n\t\t\t\tApp.LocalStorage.logEvent(\"DomLog\", \"AjaxFail Status= \" + textStatus + \" URL= \" + @ACTIONS_URI + \" Error= \" + errorThrown)\r\n\t\t\t\t@numRefreshFailuresSinceSuccess++\r\n\t\t\t\tsetTimeout =>\r\n\t\t\t\t\t@getActionGroups\r\n\t\t\t\t, (if @numRefreshFailuresSinceSuccess is 1 then @firstRefreshAfterFailSecs * 1000 else @nextRefreshesAfterFailSecs * 1000)\r\n\t\t\t\t# Use stored data if available\r\n\t\t\t\tstoredData = App.LocalStorage.get(@ACTIONS_URI)\r\n\t\t\t\tconsole.log \"domiticz-server Getting data stored for \" + @ACTIONS_URI + \" result = \" + storedData\r\n\t\t\t\tif storedData?\r\n\t\t\t\t\t# console.log \"Using stored data\" + JSON.stringify(storedData)\r\n\t\t\t\t\tconsole.log \"domiticz-server Using stored data for \" + @ACTIONS_URI\r\n\t\t\t\t\t@processRecvdActions(storedData)\r\n\t\t\t\treturn\r\n\t\treturn\r\n\r\n\tprocessRecvdActions: (data) ->\r\n\t\t@scenes = @getScenes(data)\r\n\t\t@scenes.sort @sortByRoomName\r\n\t\t@dataReadyCallback(@serverDef.name, @scenes)\r\n\r\n\tsortByRoomName: (a, b) ->\r\n\t\tif a.groupName < b.groupName then return -1\r\n\t\tif a.groupName > b.groupName then return 1\r\n\t\treturn 0\r\n\r\n\tgetScenes: (data, rooms) ->\r\n\t\tserverScenes = data.result\r\n\t\tscenes = []\r\n\t\tif serverScenes?\r\n\t\t\tfor serverScene in serverScenes\r\n\t\t\t\tname = serverScene.Name.split(\" - \")\r\n\t\t\t\tactionName = serverScene.Name\r\n\t\t\t\tif name.length > 1\r\n\t\t\t\t\troomName = name[0].trim()\r\n\t\t\t\t\tactionName = name[1].trim()\r\n\t\t\t\tscene = \r\n\t\t\t\t\tactionNum: \"\"\r\n\t\t\t\t\tactionName: roomName + \" \" + actionName\r\n\t\t\t\t\tgroupName: roomName\r\n\t\t\t\t\tactionUrl: @serverDef.url + \"/json.htm?type=command&param=switchscene&idx=\" + serverScene.idx + \"&switchcmd=On\"\r\n\t\t\t\t\ticonName: @manager.getIconFromActionName(actionName, @serverDef.iconAliasing)\r\n\t\t\t\tscenes.push(scene)\r\n\t\treturn scenes\r\n"
  ]
}