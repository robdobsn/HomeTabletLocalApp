// Generated by CoffeeScript 1.6.3
var TileTier;

TileTier = (function() {
  function TileTier(parentTag, tierName) {
    this.parentTag = parentTag;
    this.tierName = tierName;
    this.groups = [];
    this.groupCols = [];
    this.groupSepPixels = 30;
    this.groupTitlesTopMargin = 60;
    this.tileSepXPixels = 20;
    this.tileSepYPixels = 20;
    this.nextTileIdx = 0;
    this.tierId = "sqTier" + this.tierName;
    this.groupTitlesClass = "sqGroupTitles";
    this.groupTitlesTagLocator = "#" + this.tierId + " ." + this.groupTitlesClass;
    this.groupsClass = "sqGroups";
    this.groupsTagLocator = "#" + this.tierId + " ." + this.groupsClass;
  }

  TileTier.prototype.addToDom = function() {
    return $(this.parentTag).html("            <div id=\"" + this.tierId + "\">\n                <div class=\"" + this.groupTitlesClass + "\"/>\n                <div class=\"" + this.groupsClass + "\">\n    <div id=\"sqTileContainer\" style=\"width:3000px;display:block;zoom:1;\">\n    </div>\n</div>\n            </div>");
  };

  TileTier.prototype.clearTiles = function() {
    var group, _i, _len, _ref, _results;
    _ref = this.groups;
    _results = [];
    for (_i = 0, _len = _ref.length; _i < _len; _i++) {
      group = _ref[_i];
      _results.push(group.clearTiles());
    }
    return _results;
  };

  TileTier.prototype.clearTileGroup = function(groupIdx) {
    if (groupIdx >= this.groups.length) {
      return;
    }
    return this.groups[groupIdx].clearTiles();
  };

  TileTier.prototype.addGroup = function(groupTitle) {
    var groupIdx, newTileGroup;
    groupIdx = this.groups.length;
    newTileGroup = new TileGroup(this, this.groupTitlesTagLocator, groupIdx, groupTitle);
    this.groups.push(newTileGroup);
    return groupIdx;
  };

  TileTier.prototype.calcLayout = function() {
    var group, isPortrait, winHeight, winWidth, _i, _len, _ref;
    winWidth = $(window).width();
    winHeight = $(window).height();
    isPortrait = winWidth < winHeight;
    this.tilesAcross = isPortrait ? 3 : 5;
    this.tilesDown = isPortrait ? 5 : 3;
    this.cellWidth = (winWidth - (this.groupSepPixels * Math.floor((this.tilesAcross - 1) / 3))) / this.tilesAcross;
    this.cellHeight = (winHeight - this.groupTitlesTopMargin) / this.tilesDown;
    this.tileWidth = this.cellWidth - this.tileSepXPixels;
    this.tileHeight = this.cellHeight - this.tileSepYPixels;
    this.groupCols = [];
    _ref = this.groups;
    for (_i = 0, _len = _ref.length; _i < _len; _i++) {
      group = _ref[_i];
      this.groupCols.push(group.getColsInGroup(this.tilesDown, isPortrait));
    }
    return isPortrait;
  };

  TileTier.prototype.getTileSize = function(colSpan) {
    return [this.tileWidth * colSpan + (this.tileSepXPixels * (colSpan - 1)), this.tileHeight];
  };

  TileTier.prototype.getGroupStartX = function(groupIdx) {
    var gIdx, xStart;
    gIdx = 0;
    xStart = 0;
    while (gIdx < groupIdx) {
      xStart += this.groupCols[gIdx] * this.cellWidth;
      gIdx += 1;
    }
    xStart += groupIdx * this.groupSepPixels;
    return xStart;
  };

  TileTier.prototype.calcFontSizePercent = function() {
    return 100 * Math.max(this.cellWidth, this.cellHeight) / 300;
  };

  TileTier.prototype.getGroupTitlePos = function(groupIdx) {
    var xStart;
    xStart = this.getGroupStartX(groupIdx);
    return [xStart, 10, "200%"];
  };

  TileTier.prototype.getCellPos = function(groupIdx, colIdx, rowIdx) {
    var cellX, cellY, colInGroup, fontScaling, xStart;
    xStart = this.getGroupStartX(groupIdx);
    colInGroup = colIdx;
    cellX = xStart + colInGroup * this.cellWidth;
    cellY = this.groupTitlesTopMargin + rowIdx * this.cellHeight;
    fontScaling = this.calcFontSizePercent();
    return [cellX, cellY, fontScaling];
  };

  TileTier.prototype.getNextTileIdx = function() {
    this.nextTileIdx += 1;
    return this.nextTileIdx;
  };

  TileTier.prototype.addTileToGroup = function(groupIdx, tile) {
    return this.groups[groupIdx].addExistingTile(tile);
  };

  TileTier.prototype.reDoLayout = function() {
    var group, isPortrait, _i, _len, _ref, _results;
    isPortrait = this.calcLayout();
    _ref = this.groups;
    _results = [];
    for (_i = 0, _len = _ref.length; _i < _len; _i++) {
      group = _ref[_i];
      _results.push(group.repositionTiles(isPortrait));
    }
    return _results;
  };

  TileTier.prototype.findExistingTile = function(tileName) {
    var existingTile, group, _i, _len, _ref;
    existingTile = null;
    _ref = this.groups;
    for (_i = 0, _len = _ref.length; _i < _len; _i++) {
      group = _ref[_i];
      existingTile = group.findExistingTile(tileName);
      if (existingTile !== null) {
        break;
      }
    }
    return existingTile;
  };

  return TileTier;

})();
