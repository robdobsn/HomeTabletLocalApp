// Generated by CoffeeScript 1.7.1
var TabletConfig;

TabletConfig = (function() {
  function TabletConfig(configURL) {
    this.configURL = configURL;
    return;
  }

  TabletConfig.prototype.setReadyCallback = function(readyCallback) {
    this.readyCallback = readyCallback;
  };

  TabletConfig.prototype.requestConfig = function() {
    var reqURL, tabName;
    reqURL = this.configURL;
    tabName = LocalStorage.get("DeviceConfigName");
    if (tabName != null) {
      reqURL = reqURL + "/" + tabName;
    }
    console.log("Requesting tablet config with URL " + reqURL);
    $.ajax(reqURL, {
      type: "GET",
      dataType: "text",
      crossDomain: true,
      success: (function(_this) {
        return function(data, textStatus, jqXHR) {
          var curTabName, jsonData, jsonText;
          jsonText = jqXHR.responseText;
          jsonData = $.parseJSON(jsonText);
          tabName = jsonData["deviceName"];
          curTabName = LocalStorage.get("DeviceConfigName");
          if ((tabName != null) && tabName !== curTabName) {
            LocalStorage.set("DeviceConfigName", tabName);
            console.log("DeviceConfigName was " + curTabName + " now set to " + tabName);
            LocalStorage.logEvent("CnfLog", "DeviceConfigName was " + curTabName + " now set to " + tabName);
          }
          _this.readyCallback(jsonData);
          LocalStorage.set(reqURL, jsonData);
          console.log("Storing data for " + reqURL + " = " + JSON.stringify(jsonData));
        };
      })(this),
      error: (function(_this) {
        return function(jqXHR, textStatus, errorThrown) {
          var storedData;
          reqURL = "http://macallan:5076/tabletconfig/tablanding";
          storedData = LocalStorage.get(reqURL);
          console.log("Config Getting data stored for " + reqURL + " result = " + storedData);
          if (storedData != null) {
            console.log("Using stored data" + JSON.stringify(storedData));
            console.log("Using stored data for " + reqURL);
            _this.readyCallback(storedData);
          }
        };
      })(this)
    });
  };

  return TabletConfig;

})();
