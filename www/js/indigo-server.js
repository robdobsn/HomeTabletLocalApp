// Generated by CoffeeScript 1.7.1
var IndigoServer;

IndigoServer = (function() {
  function IndigoServer(serverURL) {
    this.serverURL = serverURL;
    this.ACTIONS_URI = this.serverURL + "/actions.xml";
  }

  IndigoServer.prototype.setReadyCallback = function(indigoReadyCallback) {
    this.indigoReadyCallback = indigoReadyCallback;
  };

  IndigoServer.prototype.getActionGroups = function() {
    var matchRe;
    matchRe = /<action\b[^>]href="(.*?).xml"[^>]*>(.*?)<\/action>/;
    return $.ajax(this.ACTIONS_URI, {
      type: "GET",
      dataType: "xml",
      crossDomain: true,
      success: (function(_this) {
        return function(data, textStatus, jqXHR) {
          var action, actionDict, actions, bLoop, pos, respText;
          bLoop = true;
          respText = jqXHR.responseText;
          actions = [];
          while (bLoop) {
            action = matchRe.exec(respText);
            if (action === null) {
              break;
            }
            pos = respText.search(matchRe);
            if (pos === -1) {
              break;
            }
            respText = respText.substring(pos + action[0].length);
            actionDict = {
              actionNum: "",
              actionName: action[2],
              groupName: "",
              actionUrl: _this.serverURL + action[1] + "?_method=execute"
            };
            actions[actions.length] = actionDict;
          }
          return _this.indigoReadyCallback(actions);
        };
      })(this)
    });
  };

  return IndigoServer;

})();
