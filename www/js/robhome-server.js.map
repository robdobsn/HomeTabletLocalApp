{
  "version": 3,
  "file": "robhome-server.js",
  "sourceRoot": "..\\..",
  "sources": [
    "www\\js\\robhome-server.coffee"
  ],
  "names": [],
  "mappings": "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",
  "sourcesContent": [
    "class App.RobHomeServer\r\n    constructor: (@manager, @serverDef, @dataReadyCallback) ->\r\n        @ACTIONS_URI = @serverDef.url + \"/scenes\"\r\n        @numRefreshFailuresSinceSuccess = 0\r\n        @firstRefreshAfterFailSecs = 10\r\n        @nextRefreshesAfterFailSecs = 60\r\n        return\r\n\r\n    setReadyCallback: (@dataReadyCallback) ->\r\n        return\r\n\r\n    reqActions: ->\r\n        console.log \"robhome-server Requesting RobHomeServer data from \" + @ACTIONS_URI\r\n        $.ajax @ACTIONS_URI,\r\n            type: \"GET\"\r\n            dataType: \"json\"\r\n            crossDomain: true\r\n            success: (data, textStatus, jqXHR) =>\r\n                @processRecvdActions(data, true)\r\n                @numRefreshFailuresSinceSuccess = 0\r\n                App.LocalStorage.set(@ACTIONS_URI, data)\r\n                return\r\n            error: (jqXHR, textStatus, errorThrown) =>\r\n\r\n                console.log(\"robhome-server \" + \" RobHomeServer AjaxFail Status= \" + textStatus + \" URL= \" + @ACTIONS_URI + \" Error= \" + errorThrown);\r\n\r\n                App.LocalStorage.logEvent(\"RobLog\", \"AjaxFail Status= \" + textStatus + \" URL= \" + @ACTIONS_URI + \" Error= \" + errorThrown)\r\n                @numRefreshFailuresSinceSuccess++\r\n                setTimeout =>\r\n                    @getActionGroups\r\n                , (if @numRefreshFailuresSinceSuccess is 1 then @firstRefreshAfterFailSecs * 1000 else @nextRefreshesAfterFailSecs * 1000)\r\n                # Use stored data if available\r\n                storedData = App.LocalStorage.get(@ACTIONS_URI)\r\n                console.log \"robhome-server Getting data stored for \" + @ACTIONS_URI + \" result = \" + storedData\r\n                if storedData?\r\n                    # console.log \"Using stored data\" + JSON.stringify(storedData)\r\n                    console.log \"robhome-server Using stored data for \" + @ACTIONS_URI\r\n                    @processRecvdActions(storedData, false)\r\n                return\r\n        return\r\n\r\n    processRecvdActions: (data, fromURI) ->\r\n        @scenes = @getScenes(data)\r\n        @scenes.sort @sortByRoomName\r\n        @dataReadyCallback(@serverDef.name, @scenes)\r\n        console.log \"robhome-server processRecvdActions from \" + (if fromURI then @ACTIONS_URI else \"STORAGE\") + \" #scenes \" + @scenes.length\r\n\r\n    sortByRoomName: (a, b) ->\r\n        if a.groupName < b.groupName then return -1\r\n        if a.groupName > b.groupName then return 1\r\n        return 0\r\n\r\n    getScenes: (data, rooms) ->\r\n        scenes = []\r\n        serverScenes = data.scenes\r\n        if serverScenes?\r\n            for serverScene in serverScenes\r\n                actionName = serverScene.room + \" - \" + serverScene.nom\r\n                # console.log \"robhome-server serverScene = \" + JSON.stringify(serverScene)\r\n                if \"urls\" of serverScene and \"room\" of serverScene and \"nom\" of serverScene\r\n                    scene = \r\n                        actionNum: \"\"\r\n                        actionName: serverScene.room + \" \" + serverScene.nom\r\n                        groupName: serverScene.room\r\n                        actionUrl: serverScene.urls.join(\";\")\r\n                        iconName: @manager.getIconFromActionName(actionName, @serverDef.iconAliasing)\r\n                    scenes.push(scene)\r\n                else\r\n                    console.warn \"robhome-server serverScene urls/nom/room missing = \" + JSON.stringify(serverScene)\r\n                # console.log \"robhome-server RobHomeServer scene \" + JSON.stringify(scene)\r\n        return scenes\r\n"
  ]
}